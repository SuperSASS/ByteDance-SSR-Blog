# 0x01 é¡¹ç›®åˆå§‹åŒ–

**é˜¶æ®µç›®æ ‡**ï¼š

- Monorepo æ¶æ„  
  å†è§„èŒƒä¸€ä¸‹åŒ…æ”¾çš„ä½ç½®
  - **è¿è¡Œæ—¶ä¾èµ–ï¼ˆçœŸçš„ä¼šæ‰“è¿›äº§ç‰©ã€åœ¨ç”Ÿäº§ç¯å¢ƒç”¨ï¼‰**ï¼šæ”¾åœ¨å„è‡ªåŒ…å†…ã€‚å¦‚ react, react-dom, koa, react-router-dom ç­‰
  - **å¼€å‘å·¥å…·ï¼ˆç¼–è¯‘ã€æ‰“åŒ…ã€æ£€æŸ¥ç”¨ï¼‰**ï¼šå°½é‡æ”¾åœ¨æ ¹ã€‚å¦‚ typescript, eslint, tsx, vitest, viteï¼ˆä¹Ÿå¯æ”¾å„è‡ªé¡¹ç›®é‡Œï¼‰ç­‰
- æ ¹ç›®å½•åŒ…
  - TS ç¼–è¯‘å™¨ + è¿è¡Œæ—¶ï¼štypscriptï¼ˆtscï¼‰+ tsxï¼ˆTypeScript æ‰§è¡Œå™¨ï¼Œè®© Node.js ç›´æ¥è¿è¡Œ TSï¼›å…¶æ˜¯ ts-node çš„ä¸Šä½å‡çº§ï¼‰
  - å¼€å‘è§„èŒƒï¼šESLint, Prettier, Commitlint, Husky
- é¡¹ç›®åŸºæœ¬ç»„ç»‡
  - apps/webï¼šReact 19 + React Router v7 + Vite  
    ä¸æ‰‹åŠ¨åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ Vite è„šæ‰‹æ¶åˆ›å»ºï¼Œè§ä¸‹
  - apps/serverï¼šKoa 3 + Koa Router + Koa Bodyparser + Koa Static + dotenv + nodemon
  - packages/shared

å‰ä¸¤ä¸ªåœ¨ä¹‹å‰çš„é¡¹ç›®ï¼ˆE-Shopï¼‰é‡Œéƒ½æœ‰å®è·µï¼Œè¿™é‡Œç•¥è¿‡ã€‚

## å‰ç«¯åˆå§‹åŒ–

ä½¿ç”¨ Vite è„šæ‰‹æ¶åˆå§‹åŒ– react-ts é¡¹ç›®ï¼Œåç»­æ…¢æ…¢æ”¹é€ ä¸º SSRã€‚

```bash
# SSR-Blog/apps/
pnpm create vite@latest ssr-blog-web --template react-ts
```

ç„¶åå¯ä»¥æ·»åŠ ä¸€äº›ä¾èµ–ï¼Œæ¯”å¦‚`react-router-dom`ï¼›ç„¶åæ›´æ–°ä¸‹`vite.config.ts`ä¸­çš„`resolve`ä¹‹ç±»çš„ã€‚

åç»­é¡¹ç›®ç»„ç»‡ç»“æ„ï¼š

```bash
src/
â”œâ”€â”€ app/            # åº”ç”¨çº§å…¥å£
â”œâ”€â”€ routes/         # è·¯ç”±é…ç½®
â”œâ”€â”€ layouts/        # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ pages/          # é¡µé¢ç»„ä»¶
â”œâ”€â”€ components/     # å¤ç”¨ UI ç»„ä»¶
â”œâ”€â”€ hooks/          # è‡ªå®šä¹‰ hooks
â”œâ”€â”€ stores/         # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”œâ”€â”€ services/       # å‰ç«¯ API å°è£…
â”œâ”€â”€ styles/         # å…¨å±€æ ·å¼
â”œâ”€â”€ assets/         # é™æ€èµ„æº
â””â”€â”€ types/          # å‰ç«¯ä¸“ç”¨ç±»å‹
```

## åç«¯åˆå§‹åŒ–

æ‰‹åŠ¨åˆ›å»ºã€‚

å†™ä¸€ä¸ª`package.json`ï¼š

```json
{
  "name": "ssr-blog-server",
  "version": "0.0.0",
  "private": true,
  "scripts": {
    "dev": "nodemon --watch src --exec ts-node src/app.ts",
    "build": "tsc",
    "lint": "eslint .",
    "start": "node dist/app.js"
  }
}
```

ç›¸åº”çš„`tsconfig.json`ã€‚

ç„¶åå®‰è£…ä¾èµ–ï¼š

```bash
# SSR-Blog/
pnpm --filter ssr-blog-server add koa @koa/router koa-bodyparser koa-static dotenv
pnpm --filter ssr-blog-server add -D @types/koa @types/koa__router @types/koa-bodyparser @types/koa-static nodemon
```

åˆ›å»ºä¸€ä¸ªç®€å•çš„`app.ts`è¿è¡Œèµ·æ¥ï¼š

```ts
import 'dotenv/config';
import Koa from 'koa';
import bodyParser from 'koa-bodyparser';
// import serve from 'koa-static';
// import path from 'path';

const app = new Koa();
const PORT = process.env.PORT || 3000;

// ä¸­é—´ä»¶
app.use(bodyParser());

// é™æ€èµ„æºï¼ˆåç»­ä¼šç”¨åˆ°ï¼‰
// app.use(serve(path.join(__dirname, '../web/dist')));

// åŸºç¡€è·¯ç”±ï¼ˆä¸´æ—¶ï¼Œåç»­ä¼šæ”¹ä¸º SSR è·¯ç”±ï¼‰
app.use(async (ctx) => {
  ctx.body = {
    message: 'SSR Blog Server - é˜¶æ®µ 0 å®Œæˆ',
    timestamp: new Date().toISOString(),
  };
});

app.listen(PORT, () => {
  console.log(`ğŸš€ Server running at http://localhost:${PORT}`);
});

export default app;
```

åç»­é¡¹ç›®ç»“æ„ï¼š

```bash
src/
â”œâ”€â”€ app.ts          # Koa å¯åŠ¨å…¥å£
â”œâ”€â”€ config/         # é…ç½®åŠ è½½
â”œâ”€â”€ routes/         # è·¯ç”±ç»„åˆå±‚
â”œâ”€â”€ controllers/    # æ§åˆ¶å™¨
â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ repositories/   # æ•°æ®è®¿é—®å°è£…
â”œâ”€â”€ db/             # PrismaClient å°è£…
â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”œâ”€â”€ types/          # åç«¯ä¸“ç”¨ç±»å‹
â””â”€â”€ logs/           # æ—¥å¿—è¾“å‡ºç›®å½•
```

## ç¯å¢ƒå˜é‡

`.env.example`

```bash
# Server
PORT=3000
NODE_ENV=development

# Database (åç»­ç”¨åˆ°)
DATABASE_URL="file:./dev.db"

# JWT (åç»­ç”¨åˆ°)
JWT_SECRET=your-secret-key-change-in-production
JWT_EXPIRES_IN=2h
```
